/**
 * AJITO テーマ - キャスト専用スクリプト
 * 圧縮済み版 (cast.min.js)
 */

document.addEventListener('DOMContentLoaded', function() {
  'use strict';
  
  // キャスト一覧のフィルター機能
  const filterButtons = document.querySelectorAll('.cast-filter button');
  const castItems = document.querySelectorAll('.castList li');
  
  if (filterButtons.length > 0 && castItems.length > 0) {
    filterButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        // アクティブクラスの切り替え
        filterButtons.forEach(function(btn) {
          btn.classList.remove('active');
        });
        this.classList.add('active');
        
        const filter = this.dataset.filter;
        
        // キャストの表示/非表示を切り替え
        castItems.forEach(function(item) {
          if (filter === 'all') {
            item.style.display = 'block';
          } else {
            const categories = item.dataset.category ? item.dataset.category.split(' ') : [];
            if (categories.includes(filter)) {
              item.style.display = 'block';
            } else {
              item.style.display = 'none';
            }
          }
        });
      });
    });
  }
  
  // キャスト詳細ページのギャラリー
  const castGallery = document.querySelector('.cast-gallery');
  if (castGallery && typeof jQuery !== 'undefined' && typeof jQuery.fn.slick !== 'undefined') {
    jQuery('.cast-gallery-main').slick({
      slidesToShow: 1,
      slidesToScroll: 1,
      arrows: false,
      fade: true,
      asNavFor: '.cast-gallery-nav'
    });
    
    jQuery('.cast-gallery-nav').slick({
      slidesToShow: 4,
      slidesToScroll: 1,
      asNavFor: '.cast-gallery-main',
      dots: false,
      centerMode: false,
      focusOnSelect: true,
      responsive: [
        {
          breakpoint: 768,
          settings: {
            slidesToShow: 3
          }
        },
        {
          breakpoint: 576,
          settings: {
            slidesToShow: 2
          }
        }
      ]
    });
  }
  
  // キャストのスケジュール表示
  const castScheduleItems = document.querySelectorAll('.cast-schedule-item');
  if (castScheduleItems.length > 0) {
    const today = new Date().getDay();
    // 日曜が0、月曜が1...なので調整
    const todayIndex = today === 0 ? 6 : today - 1;
    
    // 今日の日付のスケジュールをハイライト
    const todaySchedule = document.querySelector(`.cast-schedule-item[data-day="${todayIndex}"]`);
    if (todaySchedule) {
      todaySchedule.classList.add('today');
    }
  }
  
  // キャストソート機能
  const sortSelect = document.querySelector('#cast-sort');
  const castList = document.querySelector('.castList');
  
  if (sortSelect && castList) {
    sortSelect.addEventListener('change', function() {
      const sortBy = this.value;
      const items = Array.from(castList.children);
      
      items.sort(function(a, b) {
        let valueA, valueB;
        
        switch (sortBy) {
          case 'name-asc':
            valueA = a.querySelector('.cast-name').textContent.trim();
            valueB = b.querySelector('.cast-name').textContent.trim();
            return valueA.localeCompare(valueB, 'ja');
          
          case 'name-desc':
            valueA = a.querySelector('.cast-name').textContent.trim();
            valueB = b.querySelector('.cast-name').textContent.trim();
            return valueB.localeCompare(valueA, 'ja');
          
          case 'new':
            valueA = parseInt(a.dataset.date || 0, 10);
            valueB = parseInt(b.dataset.date || 0, 10);
            return valueB - valueA;
          
          case 'popular':
            valueA = parseInt(a.dataset.popular || 0, 10);
            valueB = parseInt(b.dataset.popular || 0, 10);
            return valueB - valueA;
          
          default:
            return 0;
        }
      });
      
      // DOMの再構築
      items.forEach(function(item) {
        castList.appendChild(item);
      });
      
      // アニメーション効果
      items.forEach(function(item, index) {
        item.style.animationDelay = (index * 0.05) + 's';
        item.classList.add('sorted');
        
        // アニメーション後にクラスを削除
        setTimeout(function() {
          item.classList.remove('sorted');
        }, 500 + (index * 50));
      });
    });
  }
  
  // キャスト検索機能
  const searchInput = document.querySelector('#cast-search');
  
  if (searchInput && castItems.length > 0) {
    searchInput.addEventListener('input', function() {
      const searchText = this.value.toLowerCase();
      
      castItems.forEach(function(item) {
        const name = item.querySelector('.cast-name').textContent.toLowerCase();
        const description = item.dataset.description ? item.dataset.description.toLowerCase() : '';
        
        if (name.includes(searchText) || description.includes(searchText)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
      
      // 検索結果がない場合のメッセージ
      const noResults = document.querySelector('.no-results');
      if (noResults) {
        const visibleItems = Array.from(castItems).filter(function(item) {
          return item.style.display !== 'none';
        });
        
        noResults.style.display = visibleItems.length === 0 ? 'block' : 'none';
      }
    });
  }
});
